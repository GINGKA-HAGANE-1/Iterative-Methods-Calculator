<!DOCTYPE html>
<html>
<head>
    <title>Iterative Methods Calculator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="logo-section">
        <button class="menu-toggle" onclick="toggleSidebar()">
            <span class="menu-line"></span>
            <span class="menu-line"></span>
            <span class="menu-line"></span>
        </button>
        <div class="logo-container">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" class="logo">
            <div class="author-name">Made By Monish A.K.A Gingka Hagane</div>
        </div>
    </div>
    <div class="container">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-content">
                <button class="tab-button active" onclick="switchTab('jacobi')">
                    <span class="method-icon">J</span>
                    <span class="method-name">Jacobi Method</span>
                </button>
                <button class="tab-button" onclick="switchTab('gauss-seidel')">
                    <span class="method-icon">G</span>
                    <span class="method-name">Gauss-Seidel Method</span>
                </button>
                <button class="tab-button" onclick="switchTab('power-method')">
                    <span class="method-icon">P</span>
                    <span class="method-name">Power Method</span>
                </button>
                <button class="tab-button" onclick="switchTab('newton-forward')">
                    <span class="method-icon">NF</span>
                    <span class="method-name">Newton Forward</span>
                </button>
                <button class="tab-button" onclick="switchTab('newton-backward')">
                    <span class="method-icon">NB</span>
                    <span class="method-name">Newton Backward</span>
                </button>
                <button class="tab-button" onclick="switchTab('newton-divided')">
                    <span class="method-icon">ND</span>
                    <span class="method-name">Newton Divided</span>
                </button>
                <button class="tab-button" onclick="switchTab('lagrange')">
                    <span class="method-icon">L</span>
                    <span class="method-name">Lagrange</span>
                </button>
            </div>
        </div>
        <h1>Iterative Methods Calculator</h1>
        
        <div class="content-wrapper">
            <div class="method-tabs sidebar" id="sidebar">
                <button class="tab-button active" onclick="switchTab('jacobi')">Jacobi Method</button>
                <button class="tab-button" onclick="switchTab('gauss-seidel')">Gauss-Seidel Method</button>
                <button class="tab-button" onclick="switchTab('power-method')">Power Method</button>
            </div>
            <div class="main-content">
                <div id="jacobi" class="tab-content active">
                    <div class="input-section">
                <h2>Jacobi Method Input</h2>
                <div class="matrix-input">
                    <h3>Matrix A (3x3)</h3>
                    <div class="matrix">
                        <input type="number" step="any" class="jacobi-matrix-cell" data-row="0" data-col="0">
                        <input type="number" step="any" class="jacobi-matrix-cell" data-row="0" data-col="1">
                        <input type="number" step="any" class="jacobi-matrix-cell" data-row="0" data-col="2">
                        <input type="number" step="any" class="jacobi-matrix-cell" data-row="1" data-col="0">
                        <input type="number" step="any" class="jacobi-matrix-cell" data-row="1" data-col="1">
                        <input type="number" step="any" class="jacobi-matrix-cell" data-row="1" data-col="2">
                        <input type="number" step="any" class="jacobi-matrix-cell" data-row="2" data-col="0">
                        <input type="number" step="any" class="jacobi-matrix-cell" data-row="2" data-col="1">
                        <input type="number" step="any" class="jacobi-matrix-cell" data-row="2" data-col="2">
                    </div>
                </div>
                <!-- Keep only one vector b input with table style -->
                <div class="vector-input">
                    <h3>Vector b</h3>
                    <table class="vector-table">
                        <tr>
                            <td>b₁</td>
                            <td><input type="number" step="any" class="jacobi-vector-cell"></td>
                        </tr>
                        <tr>
                            <td>b₂</td>
                            <td><input type="number" step="any" class="jacobi-vector-cell"></td>
                        </tr>
                        <tr>
                            <td>b₃</td>
                            <td><input type="number" step="any" class="jacobi-vector-cell"></td>
                        </tr>
                    </table>
                </div>
                <button onclick="solveJacobi()">Solve using Jacobi</button>
            </div>
            <div class="method-result" id="jacobi-result">
                <div class="iterations"></div>
            </div>
        </div>

        <div id="gauss-seidel" class="tab-content">
            <div class="input-section">
                <h2>Gauss-Seidel Method Input</h2>
                <div class="matrix-input">
                    <h3>Matrix A (3x3)</h3>
                    <div class="matrix">
                        <input type="number" step="any" class="gauss-matrix-cell" data-row="0" data-col="0">
                        <input type="number" step="any" class="gauss-matrix-cell" data-row="0" data-col="1">
                        <input type="number" step="any" class="gauss-matrix-cell" data-row="0" data-col="2">
                        <input type="number" step="any" class="gauss-matrix-cell" data-row="1" data-col="0">
                        <input type="number" step="any" class="gauss-matrix-cell" data-row="1" data-col="1">
                        <input type="number" step="any" class="gauss-matrix-cell" data-row="1" data-col="2">
                        <input type="number" step="any" class="gauss-matrix-cell" data-row="2" data-col="0">
                        <input type="number" step="any" class="gauss-matrix-cell" data-row="2" data-col="1">
                        <input type="number" step="any" class="gauss-matrix-cell" data-row="2" data-col="2">
                    </div>
                </div>
                <!-- Replace the Gauss-Seidel vector input section -->
                <div class="vector-input">
                    <h3>Vector b</h3>
                    <table class="vector-table">
                        <tr>
                            <td>b₁</td>
                            <td><input type="number" step="any" class="gauss-vector-cell"></td>
                        </tr>
                        <tr>
                            <td>b₂</td>
                            <td><input type="number" step="any" class="gauss-vector-cell"></td>
                        </tr>
                        <tr>
                            <td>b₃</td>
                            <td><input type="number" step="any" class="gauss-vector-cell"></td>
                        </tr>
                    </table>
                </div>
                <button onclick="solveGaussSeidel()">Solve using Gauss-Seidel</button>
            </div>
            <div class="method-result" id="gauss-seidel-result">
                <div class="iterations"></div>
            </div>
        </div>

        <!-- Remove duplicate script tags and combine all JavaScript into one section -->
                <script>
                    function switchTab(tabId) {
                        // Hide all tabs
                        document.querySelectorAll('.tab-content').forEach(tab => {
                            tab.classList.remove('active');
                        });
                        document.querySelectorAll('.tab-button').forEach(button => {
                            button.classList.remove('active');
                        });
                        
                        // Show selected tab
                        document.getElementById(tabId).classList.add('active');
                        document.querySelector(`[onclick="switchTab('${tabId}')"]`).classList.add('active');
                    }
                    
                    function solveJacobi() {
                        const matrix = [];
                        for (let i = 0; i < 3; i++) {
                            matrix[i] = [];
                            for (let j = 0; j < 3; j++) {
                                matrix[i][j] = parseFloat(document.querySelector(`.jacobi-matrix-cell[data-row="${i}"][data-col="${j}"]`).value);
                            }
                        }
                        
                        const vector = Array.from(document.querySelectorAll('.jacobi-vector-cell')).map(input => parseFloat(input.value));
                        
                        fetch('/solve', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                matrix: matrix,
                                vector: vector
                            }),
                        })
                        .then(response => response.json())
                        .then(data => {
                            displayResults('jacobi', data.jacobi);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('An error occurred while solving the system.');
                        });
                    }
                    
                    function solveGaussSeidel() {
                        const matrix = [];
                        for (let i = 0; i < 3; i++) {
                            matrix[i] = [];
                            for (let j = 0; j < 3; j++) {
                                matrix[i][j] = parseFloat(document.querySelector(`.gauss-matrix-cell[data-row="${i}"][data-col="${j}"]`).value);
                            }
                        }
                        
                        const vector = Array.from(document.querySelectorAll('.gauss-vector-cell')).map(input => parseFloat(input.value));
                        
                        fetch('/solve', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                matrix: matrix,
                                vector: vector
                            }),
                        })
                        .then(response => response.json())
                        .then(data => {
                            displayResults('gauss-seidel', data.gauss_seidel);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('An error occurred while solving the system.');
                        });
                    }
                </script>

        <div id="power-method" class="tab-content">
            <div class="input-section">
                <h2>Power Method Input</h2>
                <div class="matrix-input">
                    <h3>Matrix A (3x3)</h3>
                    <div class="method-explanation">
                        <p>Process:</p>
                        <ol>
                            <li>Initial vector x₀ = [1, 1, 1]</li>
                            <li>Normalize x₀ by dividing by √3 to get x₀ = [0.577, 0.577, 0.577]</li>
                            <li>Multiply: A × x₀</li>
                            <li>Normalize result to get x₁</li>
                            <li>Repeat until convergence</li>
                        </ol>
                    </div>
                    <div class="matrix">
                        <input type="number" step="any" class="power-matrix-cell" data-row="0" data-col="0">
                        <input type="number" step="any" class="power-matrix-cell" data-row="0" data-col="1">
                        <input type="number" step="any" class="power-matrix-cell" data-row="0" data-col="2">
                        <input type="number" step="any" class="power-matrix-cell" data-row="1" data-col="0">
                        <input type="number" step="any" class="power-matrix-cell" data-row="1" data-col="1">
                        <input type="number" step="any" class="power-matrix-cell" data-row="1" data-col="2">
                        <input type="number" step="any" class="power-matrix-cell" data-row="2" data-col="0">
                        <input type="number" step="any" class="power-matrix-cell" data-row="2" data-col="1">
                        <input type="number" step="any" class="power-matrix-cell" data-row="2" data-col="2">
                    </div>
                </div>
                <button onclick="solvePowerMethod()">Find Eigenvalue</button>
            </div>
            <div class="method-result" id="power-method-result">
                <div class="iterations"></div>
            </div>
        </div>

        <script>
            function solvePowerMethod() {
                const matrix = [];
                for (let i = 0; i < 3; i++) {
                    matrix[i] = [];
                    for (let j = 0; j < 3; j++) {
                        matrix[i][j] = parseFloat(document.querySelector(`.power-matrix-cell[data-row="${i}"][data-col="${j}"]`).value);
                    }
                }
                
                fetch('/power-method', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        matrix: matrix
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    displayPowerResults(data);
                });
            }

            function displayPowerResults(results) {
                const container = document.querySelector('#power-method-result .iterations');
                container.innerHTML = '';
                
                results.iterations.forEach(iteration => {
                    const iterationDiv = document.createElement('div');
                    iterationDiv.className = 'iteration-step';
                    
                    iterationDiv.innerHTML = `
                        <h3>AX${iteration.iteration} =</h3>
                        <div class="matrix-calculation">
                            [${iteration.matrix[0].join(' ')}] × [${iteration.vector[0].toFixed(5)}]   [${iteration.result[0].toFixed(5)}]
                            [${iteration.matrix[1].join(' ')}] × [${iteration.vector[1].toFixed(5)}] = [${iteration.result[1].toFixed(5)}] = ${iteration.eigenvalue.toFixed(5)} X${iteration.iteration + 1}
                            [${iteration.matrix[2].join(' ')}] × [${iteration.vector[2].toFixed(5)}]   [${iteration.result[2].toFixed(5)}]
                        </div>
                        <div class="next-vector">
                            ${iteration.next_vector_label}
                        </div>
                    `;
                    
                    container.appendChild(iterationDiv);
                });
            }
        </script>

        <script>
            function displayResults(method, results) {
                const container = document.querySelector(`#${method}-result .iterations`);
                container.innerHTML = '';
                
                // Display initial guess X₀
                const initialDiv = document.createElement('div');
                initialDiv.className = 'iteration';
                initialDiv.innerHTML = `
                    <h3>Initial Guess (X₀)</h3>
                    <div class="values">
                        x = 0<br>
                        y = 0<br>
                        z = 0
                    </div>
                `;
                container.appendChild(initialDiv);
                
                results.iterations.forEach(iteration => {
                    if (iteration.steps && iteration.steps.length > 0) {
                        const iterationDiv = document.createElement('div');
                        iterationDiv.className = 'iteration-step';
                        
                        let stepsHtml = `<h4>Iteration ${iteration.iteration}</h4>`;
                        iteration.steps.forEach(step => {
                            stepsHtml += `<div class="step-calculation">${step}</div>`;
                        });
                        
                        iterationDiv.innerHTML = stepsHtml;
                        container.appendChild(iterationDiv);
                    }
                });
                
                if (results.converged) {
                    const finalDiv = document.createElement('div');
                    finalDiv.className = 'final-result';
                    finalDiv.innerHTML = `
                        <h4>Final Solution:</h4>
                        <div class="values">
                            x = ${results.final[0].toFixed(5)}<br>
                            y = ${results.final[1].toFixed(5)}<br>
                            z = ${results.final[2].toFixed(5)}
                        </div>
                    `;
                    container.appendChild(finalDiv);
                }
            }
        </script>

        <script>
            function toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                const mainContent = document.querySelector('.main-content');
                sidebar.classList.toggle('active');
                mainContent.classList.toggle('shifted');
            }
        </script>
    </body>
</html>

            <!-- Add this inside the main-content div, after your existing tab contents -->
            
            <div id="newton-forward" class="tab-content">
                <div class="input-section">
                    <h2>Newton's Forward Interpolation</h2>
                    <div class="interpolation-input">
                        <div class="point-input">
                            <label>Number of points:</label>
                            <input type="number" id="forward-points" min="2" value="4" onchange="updateForwardInputs()">
                        </div>
                        <div id="forward-data-points"></div>
                        <div class="point-input">
                            <label>Find y for x = </label>
                            <input type="number" step="any" id="forward-x-target">
                        </div>
                        <button onclick="solveNewtonForward()">Calculate</button>
                    </div>
                </div>
                <div class="method-result" id="forward-result"></div>
            </div>
            
            <!-- Add this inside the main-content div -->
            <div id="newton-backward" class="tab-content">
                <div class="input-section">
                    <h2>Newton's Backward Interpolation</h2>
                    <div class="interpolation-input">
                        <div class="point-input">
                            <label>Number of points:</label>
                            <input type="number" id="backward-points" min="2" value="4" onchange="updateBackwardInputs()">
                        </div>
                        <div id="backward-data-points"></div>
                        <div class="point-input">
                            <label>Find y for x = </label>
                            <input type="number" step="any" id="backward-x-target">
                        </div>
                        <button onclick="solveNewtonBackward()">Calculate</button>
                    </div>
                </div>
                <div class="method-result" id="backward-result"></div>
            </div>
            
            <script>
                function updateForwardInputs() {
                    const n = parseInt(document.getElementById('forward-points').value);
                    const container = document.getElementById('forward-data-points');
                    container.innerHTML = '';
                    
                    for (let i = 0; i < n; i++) {
                        container.innerHTML += `
                            <div class="point-input">
                                <label>Point ${i + 1}:</label>
                                <input type="number" step="any" class="forward-x" placeholder="x${i+1}">
                                <input type="number" step="any" class="forward-y" placeholder="y${i+1}">
                            </div>
                        `;
                    }
                }
            
                function solveNewtonForward() {
                    const x_values = Array.from(document.querySelectorAll('.forward-x')).map(input => parseFloat(input.value));
                    const y_values = Array.from(document.querySelectorAll('.forward-y')).map(input => parseFloat(input.value));
                    const x_target = parseFloat(document.getElementById('forward-x-target').value);

                    fetch('/interpolate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            x_values: x_values,
                            y_values: y_values,
                            x_target: x_target,
                            method: 'forward'
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            document.getElementById('forward-result').innerHTML = `<div class="error">${data.error}</div>`;
                            return;
                        }
                        
                        let html = '<div class="calculation-steps">';
                        
                        // Display difference table with header
                        html += `
                            <div class="result-section">
                                <h3 class="section-title">Difference Table:</h3>
                                <div class="difference-table">
                                    <div class="table-explanation">
                                        This table shows the forward differences used in the calculation:
                                        <ul>
                                            <li>First column: Original y values</li>
                                            <li>Following columns: Forward differences of increasing order</li>
                                        </ul>
                                    </div>
                                    ${data.difference_table.map(row => row.map(val => val.toFixed(4)).join(' | ')).join('<br>')}
                                </div>
                            </div>`;
                        
                        // Display calculation steps with detailed explanation
                        html += `
                            <div class="result-section">
                                <h3 class="section-title">Detailed Calculation Steps:</h3>
                                <div class="steps-explanation">
                                    <p>Newton's Forward Formula: y(x) = y₀ + p∆y₀ + (p(p-1)/2!)∆²y₀ + ...</p>
                                    <p>where p = (x - x₀)/h</p>
                                </div>`;
                        
                        data.steps.forEach(step => {
                            html += `<div class="calculation-step">${step}</div>`;
                        });
                        html += '</div>';
                        
                        // Display final result
                        html += `
                            <div class="result-section final">
                                <h3 class="section-title">Final Result:</h3>
                                <div class="final-value">y(${x_target}) = ${data.result.toFixed(4)}</div>
                            </div>`;
                        
                        html += '</div>';
                        document.getElementById('forward-result').innerHTML = html;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById('forward-result').innerHTML = '<div class="error">An error occurred during calculation.</div>';
                    });
                }
            
                function updateBackwardInputs() {
                    const n = parseInt(document.getElementById('backward-points').value);
                    const container = document.getElementById('backward-data-points');
                    container.innerHTML = '';
                    
                    for (let i = 0; i < n; i++) {
                        container.innerHTML += `
                            <div class="point-input">
                                <label>Point ${i + 1}:</label>
                                <input type="number" step="any" class="backward-x" placeholder="x${i+1}">
                                <input type="number" step="any" class="backward-y" placeholder="y${i+1}">
                            </div>
                        `;
                    }
                }
            
                function solveNewtonBackward() {
                    const x_values = Array.from(document.querySelectorAll('.backward-x')).map(input => parseFloat(input.value));
                    const y_values = Array.from(document.querySelectorAll('.backward-y')).map(input => parseFloat(input.value));
                    const x_target = parseFloat(document.getElementById('backward-x-target').value);

                    fetch('/interpolate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            x_values: x_values,
                            y_values: y_values,
                            x_target: x_target,
                            method: 'backward'
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            document.getElementById('backward-result').innerHTML = `<div class="error">${data.error}</div>`;
                            return;
                        }
                        
                        let html = '<div class="calculation-steps">';
                        
                        // Display difference table with header
                        html += `
                            <div class="result-section">
                                <h3 class="section-title">Difference Table:</h3>
                                <div class="difference-table">
                                    <div class="table-explanation">
                                        This table shows the backward differences used in the calculation:
                                        <ul>
                                            <li>First column: Original y values</li>
                                            <li>Following columns: Backward differences of increasing order</li>
                                            <li>Last row contains the values used in calculation</li>
                                        </ul>
                                    </div>
                                    ${data.difference_table.map((row, index) => 
                                        row.slice(0, data.difference_table.length - index)
                                        .map(val => val.toFixed(4))
                                        .join(' | '))
                                    .join('<br>')}
                                </div>
                            </div>`;
                        
                        // Display calculation steps with detailed explanation
                        html += `
                            <div class="result-section">
                                <h3 class="section-title">Detailed Calculation Steps:</h3>
                                <div class="steps-explanation">
                                    <p>Newton's Backward Formula: y(x) = yₙ + p∇yₙ + (p(p+1)/2!)∇²yₙ + ...</p>
                                    <p>where p = (x - xₙ)/h and xₙ is the last point</p>
                                </div>`;
                        
                        data.steps.forEach(step => {
                            html += `<div class="calculation-step">${step}</div>`;
                        });
                        html += '</div>';
                        
                        // Display final result
                        html += `
                            <div class="result-section final">
                                <h3 class="section-title">Final Result:</h3>
                                <div class="final-value">y(${x_target}) = ${data.result.toFixed(4)}</div>
                            </div>`;
                        
                        html += '</div>';
                        document.getElementById('backward-result').innerHTML = html;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById('backward-result').innerHTML = '<div class="error">An error occurred during calculation.</div>';
                    });
                }
            
                // Initialize both forward and backward inputs when page loads
                document.addEventListener('DOMContentLoaded', function() {
                    updateForwardInputs();
                    if (document.getElementById('backward-points')) {
                        updateBackwardInputs();
                    }
                });
            </script>

            <div id="lagrange" class="tab-content">
                <div class="input-section">
                    <h2>Lagrange Interpolation</h2>
                    <div class="interpolation-input">
                        <div class="point-input">
                            <label>Number of points:</label>
                            <input type="number" id="lagrange-points" min="2" value="4" onchange="updateLagrangeInputs()">
                        </div>
                        <div id="lagrange-data-points"></div>
                        <div class="point-input">
                            <label>Find y for x = </label>
                            <input type="number" step="any" id="lagrange-x-target">
                        </div>
                        <button onclick="solveLagrange()">Calculate</button>
                    </div>
                </div>
                <div class="method-result" id="lagrange-result"></div>
            </div>

            <script>
                function updateLagrangeInputs() {
                    const n = parseInt(document.getElementById('lagrange-points').value);
                    const container = document.getElementById('lagrange-data-points');
                    container.innerHTML = '';
                    
                    for (let i = 0; i < n; i++) {
                        container.innerHTML += `
                            <div class="point-input">
                                <label>Point ${i + 1}:</label>
                                <input type="number" step="any" class="lagrange-x" placeholder="x${i+1}">
                                <input type="number" step="any" class="lagrange-y" placeholder="y${i+1}">
                            </div>
                        `;
                    }
                }

                function solveLagrange() {
                    const x_values = Array.from(document.querySelectorAll('.lagrange-x')).map(input => parseFloat(input.value));
                    const y_values = Array.from(document.querySelectorAll('.lagrange-y')).map(input => parseFloat(input.value));
                    const x_target = parseFloat(document.getElementById('lagrange-x-target').value);

                    // Add input validation
                    if (x_values.some(isNaN) || y_values.some(isNaN) || isNaN(x_target)) {
                        document.getElementById('lagrange-result').innerHTML = '<div class="error">Please fill in all values correctly</div>';
                        return;
                    }

                    fetch('/interpolate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            x_values: x_values,
                            y_values: y_values,
                            x_target: x_target,
                            method: 'lagrange'
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            document.getElementById('lagrange-result').innerHTML = `<div class="error">${data.error}</div>`;
                            return;
                        }
                        
                        let html = '<div class="calculation-steps">';
                        
                        // Display explanation and formula
                        html += `
                            <div class="result-section">
                                <h3 class="section-title">Lagrange Interpolation Method</h3>
                                <div class="method-explanation">
                                    <p>The Lagrange interpolation formula is:</p>
                                    <p class="formula">P(x) = Σ yᵢLᵢ(x)</p>
                                    <p>where Lᵢ(x) = Π (x - xⱼ)/(xᵢ - xⱼ), j ≠ i</p>
                                    <ol>
                                        <li>Calculate each Lagrange basis polynomial Lᵢ(x)</li>
                                        <li>Multiply each Lᵢ(x) by its corresponding yᵢ value</li>
                                        <li>Sum all terms to get the final interpolated value</li>
                                    </ol>
                                </div>
                            </div>`;
                        
                        // Display calculation steps
                        html += `
                            <div class="result-section">
                                <h3 class="section-title">Calculation Steps:</h3>
                                <div class="steps-explanation">
                                    <p>Newton's Divided Difference Formula:</p>
                                    <p>f(x) = f(x₀) + f[x₀,x₁](x-x₀) + f[x₀,x₁,x₂](x-x₀)(x-x₁) + ...</p>
                                </div>
                                <div class="given-values">
                                    <h4>Given Values:</h4>
                                    <div class="values-grid">
                                        ${x_values.map((x, i) => `x${i} = ${x}, f(x${i}) = ${y_values[i]}`).join('<br>')}
                                    </div>
                                </div>
                                <div class="formula-development">
                                    <h4>Formula Development:</h4>`;
                        
                        data.steps.forEach(step => {
                            html += `<div class="calculation-step">
                                <div class="step-formula">${step}</div>
                            </div>`;
                        });
                        
                        html += `</div>`;
                        
                        // Display final result
                        html += `
                            <div class="result-section final">
                                <h3 class="section-title">Final Result:</h3>
                                <div class="final-value">
                                    <p>At x = ${x_target}:</p>
                                    <p class="result">y = ${data.result.toFixed(4)}</p>
                                </div>
                            </div>`;
                        
                        html += '</div>';
                        document.getElementById('lagrange-result').innerHTML = html;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById('lagrange-result').innerHTML = '<div class="error">An error occurred during calculation.</div>';
                    });
                }

                // Initialize lagrange inputs when page loads
                document.addEventListener('DOMContentLoaded', function() {
                    if (document.getElementById('lagrange-points')) {
                        updateLagrangeInputs();
                    }
                });
            </script>

            <!-- Add after the lagrange div and before the closing body tag -->
            <div id="newton-divided" class="tab-content">
                <div class="input-section">
                    <h2>Newton's Divided Difference Interpolation</h2>
                    <div class="interpolation-input">
                        <div class="point-input">
                            <label>Number of points:</label>
                            <input type="number" id="divided-points" min="2" value="4" onchange="updateDividedInputs()">
                        </div>
                        <div id="divided-data-points"></div>
                        <div class="point-input">
                            <label>Find y for x = </label>
                            <input type="number" step="any" id="divided-x-target">
                        </div>
                        <button onclick="solveNewtonDivided()">Calculate</button>
                    </div>
                </div>
                <div class="method-result" id="divided-result"></div>
            </div>

            <script>
                function updateDividedInputs() {
                    const n = parseInt(document.getElementById('divided-points').value);
                    const container = document.getElementById('divided-data-points');
                    container.innerHTML = '';
                    
                    for (let i = 0; i < n; i++) {
                        container.innerHTML += `
                            <div class="point-input">
                                <label>Point ${i + 1}:</label>
                                <input type="number" step="any" class="divided-x" placeholder="x${i+1}">
                                <input type="number" step="any" class="divided-y" placeholder="y${i+1}">
                            </div>
                        `;
                    }
                }

                function solveNewtonDivided() {
                    const x_values = Array.from(document.querySelectorAll('.divided-x')).map(input => parseFloat(input.value));
                    const y_values = Array.from(document.querySelectorAll('.divided-y')).map(input => parseFloat(input.value));
                    const x_target = parseFloat(document.getElementById('divided-x-target').value);

                    if (x_values.some(isNaN) || y_values.some(isNaN) || isNaN(x_target)) {
                        document.getElementById('divided-result').innerHTML = '<div class="error">Please fill in all values correctly</div>';
                        return;
                    }

                    fetch('/interpolate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            x_values: x_values,
                            y_values: y_values,
                            x_target: x_target,
                            method: 'divided'
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            document.getElementById('divided-result').innerHTML = `<div class="error">${data.error}</div>`;
                            return;
                        }
                        
                        let html = '<div class="calculation-steps">';
                        
                        // Display divided difference table
                        html += `
                            <div class="result-section">
                                <h3 class="section-title">Divided Difference Table:</h3>
                                <div class="difference-table">
                                    <div class="table-explanation">
                                        <p>This table shows the divided differences:</p>
                                        <ul>
                                            <li>First column: Original y values</li>
                                            <li>Following columns: Divided differences of increasing order</li>
                                            <li>Each value is calculated as: f[x₁,x₂] = (f[x₂]-f[x₁])/(x₂-x₁)</li>
                                        </ul>
                                    </div>
                                    ${data.difference_table.map(row => row.map(val => val.toFixed(4)).join(' | ')).join('<br>')}
                                </div>
                            </div>`;
                        
                        // Display calculation steps
                        html += `
                            <div class="result-section">
                                <h3 class="section-title">Calculation Steps:</h3>
                                <div class="steps-explanation">
                                    <p>Newton's Divided Difference Formula:</p>
                                    <p>f(x) = f(x₀) + f[x₀,x₁](x-x₀) + f[x₀,x₁,x₂](x-x₀)(x-x₁) + ...</p>
                                </div>`;
                        
                        data.steps.forEach(step => {
                            html += `<div class="calculation-step">${step}</div>`;
                        });
                        
                        // Display final result
                        html += `
                            <div class="result-section final">
                                <h3 class="section-title">Final Result:</h3>
                                <div class="final-value">y(${x_target}) = ${data.result.toFixed(4)}</div>
                            </div>`;
                        
                        html += '</div>';
                        document.getElementById('divided-result').innerHTML = html;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById('divided-result').innerHTML = '<div class="error">An error occurred during calculation.</div>';
                    });
                }

                // Initialize divided inputs when page loads
                document.addEventListener('DOMContentLoaded', function() {
                    if (document.getElementById('divided-points')) {
                        updateDividedInputs();
                    }
                });
            </script>

            <style>
                /* Add these styles in your existing style section */
                .values-grid {
                    margin: 10px 0;
                    padding: 10px;
                    background: #f5f5f5;
                    border-radius: 5px;
                }
                
                .formula-development {
                    margin-top: 15px;
                }
                
                .step-formula {
                    font-family: 'Computer Modern', serif;
                    font-size: 1.1em;
                    margin: 10px 0;
                    padding: 8px;
                    background: #fff;
                    border-left: 3px solid #2196F3;
                }
                
                .given-values {
                    margin: 15px 0;
                    padding: 10px;
                    border: 1px solid #e0e0e0;
                    border-radius: 5px;
                }
            </style>